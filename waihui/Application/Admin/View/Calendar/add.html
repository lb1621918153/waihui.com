    <include file="Base/css"/>
</head>
<body>
<!-- WRAPPER -->
<div id="wrapper">
    <!-- NAVBAR -->
    <include file="Base/navbar"/>
    <!-- END NAVBAR -->
    <!-- LEFT SIDEBAR -->
    <include file="Base/sidebar"/>
    <!-- END LEFT SIDEBAR -->
    <!-- MAIN -->
    <div class="main">
        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="container-fluid">
                <h3 class="page-title">财经日历管理</h3>
                <div>
                    <!-- BORDERED TABLE -->
                    <div class="panel">
                        <div class="panel-heading">
                            <h3 class="panel-title">财经日历信息编辑</h3>
                        </div>
                        <div class="panel-body">
                            <form id="form" action="" method="post">
                            <div class="row">
                                <div class="col-sm-2 text-right">地区：</div>
                                <div class="col-sm-10 form-inline">
                                    <input type="file" id="btn_file" style="display:none" accept="image/*">
                                    <input id="area" type="text" name="area" class="form-control" size="67" placeholder="图片地址">
                                    <span class="btn btn-info" data-target="#imageSelect" data-toggle="modal">选择服务器图片</span>
                                    <span class="btn btn-info" onclick="openFileSelect()">本地上传图片</span>
                                    <br><br>
                                    <img id="preview" src="" alt="地区图片" width="100">
                                </div>
                            </div>
                            <div class="row row-height">
                                <div class="col-sm-2 text-right">日期：</div>
                                <div class="col-sm-10 form-inline"><input name="date" class="form-control" type="date"></div>
                            </div>
                            <div class="row row-height">
                                <div class="col-sm-2 text-right">时间：</div>
                                <div class="col-sm-10 form-inline"><input name="time" class="form-control" type="time"></div>
                            </div>
                            <div class="row row-height">
                                <div class="col-sm-2 text-right">指标名称：</div>
                                <div class="col-sm-10 form-inline"><textarea name="name" class="form-control"
                                                                             cols="70"></textarea></div>
                            </div>
                            <div class="row row-height">
                                <div class="col-sm-2 text-right">前值：</div>
                                <div class="col-sm-10 form-inline"><input name="before_value" class="form-control" type="number"></div>
                            </div>
                            <div class="row row-height">
                                <div class="col-sm-2 text-right">预期：</div>
                                <div class="col-sm-10 form-inline">
                                    <input name="expected" class="form-control" type="number">
                                </div>
                            </div>
                            <div class="row row-height">
                                <div class="col-sm-2 text-right">公布：</div>
                                <div class="col-sm-10 form-inline">
                                    <input name="announce" class="form-control" type="number">
                                </div>
                            </div>
                            <div class="row row-height">
                                <div class="col-sm-2 text-right">影响：</div>
                                <div class="col-sm-10 form-inline"><input name="effect" class="form-control" type="text"></div>
                            </div>
                            <div class="row row-height">
                                <div class="col-sm-2"></div>
                                <div class="col-sm-10">
                                    <input type="submit" class="btn btn-primary" value="确认添加">
                                </div>
                            </div>
                        </form>
                        </div>
                        <br><br><br><br>
                    </div>
                </div>
            </div>
        </div>
        <!-- END MAIN CONTENT -->
    </div>
    <!-- END MAIN -->
    <include file="Base/footer"/>
</div>
<div id="imageSelect" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="imageSelect">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">图片选择</h4>
            </div>
            <div class="modal-body">
                <volist name="images" id="image" empty="服务器当前没有图片">
                    <a class="image-select text-center" onclick="selectImg(this)">
                        <img src="__PUBLIC__{$image}" alt="" width="60">
                    </a>
                </volist>
                <div class="clearfix"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal">确认</button>
            </div>
        </div>
    </div>
</div>
<!-- END WRAPPER -->
<!-- Javascript -->
<include file="Base/script"/>
<script>
    const SCOPE = {
        updatePwdUrl: '__MODULE__/admin/update',
        deleteDataUrl: '__CONTROLLER__/del',
        showDataUrl: '__CONTROLLER__/detail',
        imageUploadUrl: '__MODULE__/image/calendarUpload'
    };

    function openFileSelect() {
        $("#btn_file").click();
    }

    function selectImg(ref) {
        var imgSrc = $(ref).children('img').attr('src');
        $("#preview").attr('src', imgSrc);
        var pub = "Public";
        $("#area").val(imgSrc.substr(imgSrc.indexOf(pub) + pub.length));
    }

    $("#btn_file").on("change", function () {
        var img = this.files[0];
        if (img) {
            var formData = new FormData();
            formData.append("area_img", img);
            $.ajax({
               url: SCOPE.imageUploadUrl,
                type: 'post',
                data: formData,
                dataType: 'json',
                processData: false,
                contentType: false,
                success: function (res) {
                    showTip(res.msg);
                    if (res.code === 0) {
                        $("#preview").attr('src', '__PUBLIC__' + res.url);
                        $("#area").val(res.url);
                    }
                },
                error: function (err) {
                    showTip('请求失败');
                }
            });
        } else {
            alert('请选择图片');
        }
    })
</script>
</body>
</html>
