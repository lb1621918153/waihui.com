<include file="Base/css"/>

<style>
    .height {
        height: 600px;
    }
</style>
</head>
<body>
<!-- WRAPPER -->
<div id="wrapper">
    <!-- NAVBAR -->
    <include file="Base/navbar"/>
    <!-- END NAVBAR -->
    <!-- LEFT SIDEBAR -->
    <include file="Base/sidebar"/>
    <!-- END LEFT SIDEBAR -->
    <!-- MAIN -->
    <div class="main">
        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="container-fluid">
                <h3 class="page-title">财经新闻管理</h3>
                <div>
                    <!-- BORDERED TABLE -->
                    <div class="panel">
                        <form action="__CONTROLLER__/update" method="post">
                            <div class="panel-heading">
                                <div class="row">
                                    <div class="col-sm-7">
                                        <h3 class="panel-title">财经新闻编辑</h3>
                                    </div>
                                    <div class="col-sm-5 text-right">
                                        <input type="submit" class="btn btn-info" value="保存">
                                    </div>
                                </div>
                            </div>
                            <div class="panel-body">
                                <input type="hidden" value="{$news.news_id}" name="news_id">
                                <div class="row row-height">
                                    <div class="col-sm-2 text-right">新闻名称：</div>
                                    <div class="col-sm-10 form-inline">
                                        <input name="news_title" class="form-control" type="text" value="{$news.news_title}" size="48">
                                        <span class="text-danger"> * 必填</span>
                                    </div>
                                </div>

                                <div class="row row-height">
                                    <div class="col-sm-2 text-right">缩略图：</div>
                                    <div class="col-sm-10 form-inline">
                                        <input type="file" id="btn_file" style="display:none" accept="image/*">
                                        <input id="newsThum" name="news_thum" class="form-control" type="text" size="48" value="{$news.news_thum}">
                                        <span class="btn btn-info" data-target="#imageSelect" data-toggle="modal">选择服务器图片</span>
                                        <span class="btn btn-info" onclick="openFileSelect()">本地上传图片</span>
                                        <br>
                                        <span class="text-danger">* 当为热点新闻时必须要有图片</span>
                                        <br>
                                        <img id="preview" src="__PUBLIC__{$news.news_thum}" alt="缩略图片预览" width="100">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-2 text-right">是否热点新闻：</div>
                                    <div class="col-sm-10">
                                        <label class="radio-inline">
                                            <input type="radio" name="hot" value="1" <if condition="$news.hot == 1">checked</if>> 是
                                        </label>
                                        <label class="radio-inline">
                                            <input type="radio" name="hot" value="0" <if condition="$news.hot == 0">checked</if>> 否
                                        </label>
                                    </div>
                                </div>
                                <br>
                                <div class="row">
                                    <div class="col-sm-2 text-right">
                                        新闻内容 <span class="text-danger">(必填)</span>：
                                    </div>
                                </div>
                                <br>
                                <script id="container" name="news_content" class="height" type="text/plain">{$news.news_content}</script>
                            </div>
                            <br><br><br><br>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!-- END MAIN CONTENT -->
    </div>
    <!-- END MAIN -->
    <include file="Base/footer"/>
</div>
<div id="imageSelect" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="imageSelect">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">图片选择</h4>
            </div>
            <div class="modal-body">
                <volist name="images" id="image" empty="服务器当前没有图片">
                    <a class="image-select text-center" onclick="selectImg(this)">
                        <img src="__PUBLIC__{$image}" alt="" width="60">
                    </a>
                </volist>
                <div class="clearfix"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal">确认</button>
            </div>
        </div>
    </div>
</div>
<!-- END WRAPPER -->
<!-- Javascript -->
<include file="Base/script"/>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/admin/ueditor/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/admin/ueditor/ueditor.all.min.js"></script>
<!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
<!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/admin/ueditor/lang/zh-cn/zh-cn.js"></script>
<script>
    const SCOPE = {
        updatePwdUrl: '__MODULE__/admin/update',
        deleteDataUrl: '__CONTROLLER__/del',
        showDataUrl: '__CONTROLLER__/detail',
        imageUploadUrl: '__MODULE__/image/newsUpload'
    };

    var ue = UE.getEditor('container');

    function openFileSelect() {
        $("#btn_file").click();
    }

    function selectImg(ref) {
        var imgSrc = $(ref).children('img').attr('src');
        $("#preview").attr('src', imgSrc);
        var pub = "Public";
        $("#newsThum").val(imgSrc.substr(imgSrc.indexOf(pub) + pub.length));
    }

    $("#btn_file").on("change", function () {
        var img = this.files[0];
        if (img) {
            var formData = new FormData();
            formData.append("area_img", img);
            $.ajax({
                url: SCOPE.imageUploadUrl,
                type: 'post',
                data: formData,
                dataType: 'json',
                processData: false,
                contentType: false,
                success: function (res) {
                    showTip(res.msg);
                    if (res.code === 0) {
                        $("#preview").attr('src', '__PUBLIC__' + res.url);
                        $("#newsThum").val(res.url);
                    }
                },
                error: function (err) {
                    showTip('请求失败');
                }
            });
        } else {
            alert('请选择图片');
        }
    })
</script>
</body>
</html>
